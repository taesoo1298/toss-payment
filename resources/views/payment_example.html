<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Toss Payments ê²°ì œ ì˜ˆì œ</title>
        <script src="https://js.tosspayments.com/v1/payment-widget"></script>
        <style>
            * {
                box-sizing: border-box;
            }
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                max-width: 600px;
                margin: 50px auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .card {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: #333;
                margin-bottom: 30px;
            }
            .form-group {
                margin-bottom: 20px;
            }
            label {
                display: block;
                margin-bottom: 8px;
                color: #555;
                font-weight: 500;
            }
            input,
            select {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 14px;
            }
            input:focus,
            select:focus {
                outline: none;
                border-color: #007bff;
            }
            .btn {
                width: 100%;
                padding: 15px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 5px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.3s;
            }
            .btn:hover {
                background-color: #0056b3;
            }
            .btn:disabled {
                background-color: #ccc;
                cursor: not-allowed;
            }
            .error {
                color: #dc3545;
                font-size: 14px;
                margin-top: 5px;
            }
            .success {
                color: #28a745;
                font-size: 14px;
                margin-top: 5px;
            }
            .loading {
                text-align: center;
                padding: 20px;
            }
        </style>
    </head>
    <body>
        <div class="card">
            <h1>ğŸš€ Toss Payments ê²°ì œ</h1>

            <form id="payment-form">
                <div class="form-group">
                    <label for="order_name">ìƒí’ˆëª…</label>
                    <input
                        type="text"
                        id="order_name"
                        name="order_name"
                        value="í…ŒìŠ¤íŠ¸ ìƒí’ˆ"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="amount">ê²°ì œ ê¸ˆì•¡ (ì›)</label>
                    <input
                        type="number"
                        id="amount"
                        name="amount"
                        value="10000"
                        min="100"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="method">ê²°ì œ ìˆ˜ë‹¨</label>
                    <select id="method" name="method" required>
                        <option value="card">ì¹´ë“œ</option>
                        <option value="virtual_account">ê°€ìƒê³„ì¢Œ</option>
                        <option value="transfer">ê³„ì¢Œì´ì²´</option>
                        <option value="mobile_phone">íœ´ëŒ€í°</option>
                        <option value="easy_pay">ê°„í¸ê²°ì œ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="customer_name">êµ¬ë§¤ìëª…</label>
                    <input
                        type="text"
                        id="customer_name"
                        name="customer_name"
                        value="í™ê¸¸ë™"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="customer_email">ì´ë©”ì¼</label>
                    <input
                        type="email"
                        id="customer_email"
                        name="customer_email"
                        value="test@example.com"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="customer_mobile_phone">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input
                        type="tel"
                        id="customer_mobile_phone"
                        name="customer_mobile_phone"
                        value="01012345678"
                        pattern="01[0-9]{8,9}"
                        placeholder="01012345678"
                    />
                </div>

                <button type="submit" class="btn" id="payment-button">
                    ê²°ì œí•˜ê¸°
                </button>

                <div id="message"></div>
            </form>
        </div>

        <script>
            // Configuration
            const API_BASE_URL = "http://localhost:8000/api";
            const TOSS_CLIENT_KEY = "test_ck_xxxxxxxxxx"; // ì—¬ê¸°ì— ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ í‚¤ ì…ë ¥
            const AUTH_TOKEN = "your-auth-token"; // ì‹¤ì œ ì¸ì¦ í† í°

            // DOM Elements
            const form = document.getElementById("payment-form");
            const button = document.getElementById("payment-button");
            const messageEl = document.getElementById("message");

            // Show message
            function showMessage(message, type = "error") {
                messageEl.textContent = message;
                messageEl.className = type;
            }

            // Clear message
            function clearMessage() {
                messageEl.textContent = "";
                messageEl.className = "";
            }

            // Handle form submission
            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                clearMessage();

                button.disabled = true;
                button.textContent = "ì²˜ë¦¬ ì¤‘...";

                try {
                    // Step 1: Prepare payment
                    const formData = new FormData(form);
                    const paymentData = {
                        order_name: formData.get("order_name"),
                        amount: parseInt(formData.get("amount")),
                        method: formData.get("method"),
                        customer_name: formData.get("customer_name"),
                        customer_email: formData.get("customer_email"),
                        customer_mobile_phone: formData.get(
                            "customer_mobile_phone"
                        ),
                    };

                    console.log("ê²°ì œ ì¤€ë¹„ ìš”ì²­:", paymentData);

                    const prepareResponse = await fetch(
                        `${API_BASE_URL}/payments/prepare`,
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${AUTH_TOKEN}`,
                                Accept: "application/json",
                            },
                            body: JSON.stringify(paymentData),
                        }
                    );

                    if (!prepareResponse.ok) {
                        throw new Error("ê²°ì œ ì¤€ë¹„ ì‹¤íŒ¨");
                    }

                    const { data } = await prepareResponse.json();
                    console.log("ê²°ì œ ì¤€ë¹„ ì™„ë£Œ:", data);

                    // Step 2: Load Toss Payments SDK
                    const tossPayments = await loadTossPayments(
                        TOSS_CLIENT_KEY
                    );

                    // Step 3: Request payment
                    const methodMap = {
                        card: "ì¹´ë“œ",
                        virtual_account: "ê°€ìƒê³„ì¢Œ",
                        transfer: "ê³„ì¢Œì´ì²´",
                        mobile_phone: "íœ´ëŒ€í°",
                        easy_pay: "ê°„í¸ê²°ì œ",
                    };

                    await tossPayments.requestPayment(
                        methodMap[data.method] || "ì¹´ë“œ",
                        {
                            amount: data.amount,
                            orderId: data.order_id,
                            orderName: data.order_name,
                            customerName: data.customer_name,
                            customerEmail: data.customer_email,
                            successUrl:
                                window.location.origin +
                                "/payments/success.html",
                            failUrl:
                                window.location.origin + "/payments/fail.html",
                        }
                    );
                } catch (error) {
                    console.error("ê²°ì œ ì˜¤ë¥˜:", error);
                    showMessage(
                        error.message || "ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                        "error"
                    );
                    button.disabled = false;
                    button.textContent = "ê²°ì œí•˜ê¸°";
                }
            });

            // For testing without authentication
            if (!AUTH_TOKEN || AUTH_TOKEN === "your-auth-token") {
                console.warn(
                    "âš ï¸ ì¸ì¦ í† í°ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‹¤ì œ ì‚¬ìš© ì‹œ ì¸ì¦ í† í°ì„ ì„¤ì •í•´ì£¼ì„¸ìš”."
                );
            }
        </script>
    </body>
</html>
